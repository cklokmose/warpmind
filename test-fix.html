<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test PDF Analysis Fix</title>
    <script src="dist/warpmind.js"></script>
</head>
<body>
    <h1>Test PDF Analysis Fix</h1>
    <input type="file" id="fileInput" accept=".pdf" />
    <button onclick="testPdfAnalysis()">Test PDF with Image Analysis</button>
    <div id="results"></div>

    <script>
        let mind;
        
        async function initializeMind() {
            mind = new WarpMind({
                apiKey: 'test-key',
                apiUrl: 'https://api.openai.com/v1',
                model: 'gpt-4o-mini'
            });
        }

        async function testPdfAnalysis() {
            if (!mind) {
                await initializeMind();
            }

            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Please select a PDF file first');
                return;
            }

            const results = document.getElementById('results');
            results.innerHTML = '<p>Processing PDF...</p>';

            try {
                // Test the PDF reading with image analysis
                console.log('Starting PDF analysis...');
                const pdfData = await mind.readPdf(file, {
                    includeImages: true,
                    imageDetail: 'low',
                    imagePrompt: 'Describe what you see in this image'
                });

                console.log('PDF analysis completed:', pdfData);
                results.innerHTML = `
                    <h3>Success!</h3>
                    <p><strong>Pages:</strong> ${pdfData.pages}</p>
                    <p><strong>Text chunks:</strong> ${pdfData.chunks.length}</p>
                    <p><strong>Images found:</strong> ${pdfData.images.length}</p>
                    <p><strong>Total tokens:</strong> ${pdfData.totalTokens}</p>
                `;
            } catch (error) {
                console.error('Error analyzing PDF:', error);
                results.innerHTML = `
                    <h3>Error</h3>
                    <p style="color: red;"><strong>Error:</strong> ${error.message}</p>
                    <p><strong>Stack:</strong> ${error.stack}</p>
                `;
            }
        }

        // Initialize on page load
        initializeMind();
    </script>
</body>
</html>
