<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Chunk Position Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="../warpmind.js"></script>
</head>
<body>
    <h1>PDF Chunk Position Test</h1>
    <p>This page tests if the "Chunk text not found..." warnings have been eliminated.</p>
    
    <div>
        <label for="fileInput">Select a PDF file:</label>
        <input type="file" id="fileInput" accept=".pdf">
        <button id="testBtn" disabled>Test PDF Processing</button>
    </div>
    
    <div id="console-output" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; background: #f5f5f5; font-family: monospace; white-space: pre-wrap;"></div>
    
    <script>
        // Override console.warn to capture warnings
        const originalConsoleWarn = console.warn;
        const consoleOutput = document.getElementById('console-output');
        let warningCount = 0;
        
        console.warn = function(...args) {
            const message = args.join(' ');
            consoleOutput.textContent += '[WARN] ' + message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            if (message.includes('Chunk text not found')) {
                warningCount++;
            }
            
            originalConsoleWarn.apply(console, args);
        };
        
        console.log = function(...args) {
            const message = args.join(' ');
            consoleOutput.textContent += '[LOG] ' + message + '\n';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        const fileInput = document.getElementById('fileInput');
        const testBtn = document.getElementById('testBtn');
        
        fileInput.addEventListener('change', function(e) {
            testBtn.disabled = !e.target.files.length;
        });
        
        testBtn.addEventListener('click', async function() {
            const file = fileInput.files[0];
            if (!file) return;
            
            warningCount = 0;
            consoleOutput.textContent = 'Starting PDF processing test...\n';
            
            try {
                // Initialize WarpMind
                const wm = new WarpMind();
                
                console.log('Processing PDF: ' + file.name);
                
                // Convert file to URL for processing
                const fileUrl = URL.createObjectURL(file);
                
                // Process the PDF
                const result = await wm.readPdf(fileUrl, {
                    id: 'test-pdf',
                    chunkTokens: 400,
                    onProgress: (progress) => {
                        console.log('Progress: ' + Math.round(progress * 100) + '%');
                    }
                });
                
                console.log('PDF processing completed successfully!');
                console.log('Number of chunks: ' + result.chunks.length);
                console.log('Number of "Chunk text not found" warnings: ' + warningCount);
                
                if (warningCount === 0) {
                    console.log('✅ SUCCESS: No chunk position warnings detected!');
                } else {
                    console.log('❌ WARNINGS: ' + warningCount + ' chunk position warnings detected');
                }
                
                // Clean up
                URL.revokeObjectURL(fileUrl);
                
            } catch (error) {
                console.log('Error processing PDF: ' + error.message);
            }
        });
    </script>
</body>
</html>
